# Ubuntu スタートアップスクリプト

このディレクトリには、Ubuntu用のスタートアップスクリプトが含まれています。

## SSHキーペアの生成（共通の前提条件）

SSHキーペアをお持ちでない場合は、ローカルマシン（サーバーではなく）で生成できます。

1.  お使いのコンピュータでターミナルを開きます（macOS/Linuxの場合はターミナル、Windowsの場合はPowerShell/WSLなど）。
2.  次のコマンドを実行します。プロンプトが表示されたら、強力なパスフレーズを入力することを強くお勧めします。
    ```bash
    ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
    ```
3.  これにより、通常は `~/.ssh/` に2つのファイルが作成されます：
    *   `id_rsa`（**秘密鍵** - このファイルは秘密にし、安全に保管してください！)
    *   `id_rsa.pub`（**公開鍵** - これをサーバーにコピーします）。

4.  公開鍵を表示してコピーするには、`cat`コマンドを使用します：
    ```bash
    cat ~/.ssh/id_rsa.pub
    ```
5.  出力全体をコピーします。これが、スクリプトの `PUBLIC_KEY` 変数に貼り付けるキーです。

---

## スクリプト一覧

すべてのスクリプトは、基本的なセキュリティ強化を実行します。内容は以下の通りです：
*   日常的な操作のための新しいユーザーを作成します。
*   新しいユーザーのSSH公開鍵認証を設定します。
*   デフォルトのSSHポートを `2222` に変更します。
*   パスワード認証とSSH経由のrootログインを無効にします。
*   UFWファイアウォールを設定します。

### `gemini-cli.sh`

このスクリプトは、Gemini CLIを備えた新しいUbuntuサーバーをセットアップします。

#### 前提条件

- あなたのSSH公開鍵。

#### 使い方

1.  スクリプト内の `PUBLIC_KEY` 変数を編集します。
2.  スクリプトをサーバーにコピーします（例：`scp`を使用）。
3.  `root` としてサーバーに接続し、スクリプトに実行権限を与え（`chmod +x`）、実行します。

#### 実行後

- 新しいユーザー（`vpsuser`）と新しいSSHポート（`2222`）でログインします。
- サーバーを再起動することをお勧めします。

### `desktop.sh`

このスクリプトは、XFCEデスクトップ環境とGoogle Chromeを備えたUbuntuサーバーをセットアップし、任意のリモートデスクトップ(RDP)クライアントからアクセスできるようにします。

#### 前提条件

- あなたのSSH公開鍵。
- 新しいユーザー用の強力なパスワード（RDPおよび `sudo` 用）。

#### 使い方

1.  スクリプト内の `PUBLIC_KEY` と `PASSWORD` 変数を編集します。
2.  スクリプトをサーバーにコピーします。
3.  `root` として接続し、スクリプトに実行権限を与え、実行します。

#### 実行後

- SSH経由で `vpsuser` としてポート `2222` で接続できます。
- RDPクライアントを使用して、サーバーのIPアドレスのポート `3389` に、ユーザー名 `vpsuser` と設定したパスワードで接続できます。

### `minecraft.sh`

このスクリプトは、最新版を自動的に実行するMinecraft Java Editionサーバーをセットアップします。安全なアクセスのためにTailscaleを使用するため、Minecraftのポートをインターネットに公開する必要はありません。

#### 前提条件

- あなたのSSH公開鍵。
- Tailscaleアカウント。

#### 使い方

1.  スクリプト内の `PUBLIC_KEY` 変数を編集します。メモリ割り当てやMOTDなどのサーバー設定も調整できます。
2.  スクリプトをサーバーにコピーします。
3.  `root` として接続し、スクリプトに実行権限を与え、実行します。

#### 実行後

1.  新しいユーザー（`mcuser`）としてポート `2222` でSSH経由でログインします。
2.  `sudo tailscale up` を実行し、ブラウザで認証します。
3.  `tailscale ip -4` でサーバーのTailscale IPを見つけます。
4.  MinecraftクライアントでこのIPアドレスに接続します。
5.  サーバーは `systemd` サービスとして実行され、起動時に自動的に開始されます。

### `wordpress.sh`

このスクリプトは、NginxとMariaDBスタックでWordPressサイトをセットアップします。

#### 前提条件

- あなたのSSH公開鍵。
- WordPressサイトをホストするためのドメイン名。

#### 使い方

1.  スクリプト内の `PUBLIC_KEY` と `DOMAIN_NAME` 変数を編集します。
2.  スクリプトをサーバーにコピーします。
3.  `root` として接続し、スクリプトに実行権限を与え、実行します。

#### 実行後

- 新しいユーザー（`vpsuser`）としてポート `2222` でSSH経由でログインします。
- Webブラウザであなたのドメイン名にアクセスし、WordPressのインストールを完了させます。
- スクリプトはランダムに生成されたデータベースのパスワードを出力しますので、安全に保管してください。

### `minecraft-bedrock.sh`

Minecraft 統合版 (Bedrock Edition) サーバーをホストするための、包括的なUbuntuサーバー環境をセットアップします。

**主な機能:**
- 専用ユーザー (`mcserver`) の作成
- SSHのセキュリティ強化（パスワード認証の無効化、ポート変更）
- セキュアなアクセスのためのTailscaleのインストールと設定
- 最新のBedrockサーバーをインストールし、`systemd`サービスとして実行
- `tmux`によるサーバーコンソールの管理

**重要な制約（開発中断中）:**
このスクリプトのセキュリティモデルは**Tailscale**に依存しています。Minecraftのゲームポート(19132/udp)をインターネットに公開しません。そのため、**Nintendo Switch**のような、Tailscaleをインストールできないゲームクライアントとは互換性がありません。代替のセキュリティモデルを検討するため、現在開発を中断しています。

### `softether.sh`（開発凍結中）

**目的:** SoftEther VPNサーバーのセットアップを自動化するスクリプトの作成。

**現在のステータス:** 現在、開発を凍結しています。このスクリプトは**動作しません**。`vpncmd`での設定中にエラーが発生します。現在判明している最後の問題は、`vpncmd`呼び出し時の作業ディレクトリが不適切なために`hamcore.se2`が見つからない、というエラーです。
